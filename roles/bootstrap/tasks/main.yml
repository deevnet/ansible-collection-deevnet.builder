---
# roles/bootstrap/tasks/main.yml
# Main task file for bootstrap role - PXE network boot server

# Install packages based on backend choice
- name: Install TFTP packages (standalone tftpd)
  ansible.builtin.import_tasks: install_tftpd.yml
  when: bootstrap_tftp_backend == "tftpd"

- name: Install dnsmasq and dependencies
  ansible.builtin.import_tasks: install_dnsmasq.yml
  when: bootstrap_tftp_backend == "dnsmasq"

- name: Setup TFTP root directory structure
  ansible.builtin.import_tasks: setup_tftp_root.yml

- name: Configure SELinux for TFTP directories
  ansible.builtin.import_tasks: setup_selinux.yml

# Configure TFTP service based on backend
- name: Configure standalone TFTP server (systemd socket)
  ansible.builtin.import_tasks: configure_tftpd.yml
  when: bootstrap_tftp_backend == "tftpd"

- name: Configure dnsmasq service
  ansible.builtin.import_tasks: configure_dnsmasq.yml
  when: bootstrap_tftp_backend == "dnsmasq"

- name: Configure PXE boot menu
  ansible.builtin.import_tasks: configure_pxelinux.yml

- name: Configure firewall rules
  ansible.builtin.import_tasks: configure_firewall.yml
