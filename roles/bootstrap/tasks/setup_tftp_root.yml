---
# roles/bootstrap/tasks/setup_tftp_root.yml

- name: Ensure TFTP root directory exists
  ansible.builtin.file:
    path: "{{ bootstrap_tftp_root }}"
    state: directory
    owner: root
    group: root
    mode: "0755"
  become: true

- name: Ensure TFTP directory tree exists
  ansible.builtin.file:
    path: "{{ bootstrap_tftp_root }}/{{ item }}"
    state: directory
    owner: root
    group: root
    mode: "0755"
  loop: "{{ bootstrap_tftp_dirs }}"
  become: true

- name: Copy PXELINUX bootloader files from syslinux (BIOS)
  ansible.builtin.copy:
    src: "/tftpboot/{{ item }}"
    dest: "{{ bootstrap_tftp_root }}/{{ item }}"
    remote_src: true
    owner: root
    group: root
    mode: "0644"
  loop:
    - pxelinux.0
    - ldlinux.c32
    - menu.c32
    - libcom32.c32
    - libutil.c32
  become: true

- name: Copy GRUB2 EFI bootloader (UEFI)
  ansible.builtin.copy:
    src: "{{ bootstrap_grub_efi_source }}"
    dest: "{{ bootstrap_tftp_root }}/grubx64.efi"
    remote_src: true
    owner: root
    group: root
    mode: "0644"
  become: true
  when: bootstrap_uefi_enabled | bool
