---
# Bootstrap node configuration for PXE network installation
# ------------------------------------------------------------------------------

# TFTP Server Backend
# ------------------------------------------------------------------------------
# Choose which TFTP server to use:
#   - "tftpd": Standalone in.tftpd via systemd socket (default, recommended)
#   - "dnsmasq": Use dnsmasq for TFTP + DHCP (legacy, requires additional config)
bootstrap_tftp_backend: "tftpd"

# TFTP Root Directory
# ------------------------------------------------------------------------------
bootstrap_tftp_root: /srv/tftp

# TFTP File Ownership
# ------------------------------------------------------------------------------
bootstrap_tftp_owner: "root"
bootstrap_tftp_group: "root"

# TFTP directory structure to create
bootstrap_tftp_dirs:
  - pxelinux.cfg
  - fedora
  - fedora/40
  - fedora/41
  - fedora/43

# ==============================================================================
# DNSMASQ-ONLY CONFIGURATION (only used when bootstrap_tftp_backend == "dnsmasq")
# ==============================================================================
# Note: All DHCP interface/subnet/range/gateway vars below are ONLY relevant
# when using the dnsmasq backend. When using tftpd backend, these are ignored.

# DHCP Configuration
# ------------------------------------------------------------------------------
# IMPORTANT: These are minimal defaults. Override in group_vars/bootstrap_nodes.yml
# with appropriate values for your network.

# DHCP range for PXE clients
bootstrap_dhcp_range_start: "192.168.1.100"
bootstrap_dhcp_range_end: "192.168.1.199"
bootstrap_dhcp_lease_time: "12h"

# Network interface for DHCP/TFTP/DNS services
# This is the KEY in infrastructure.interfaces (e.g., "eth0", "mgmt")
# The actual OS interface is discovered from the MAC address at runtime
bootstrap_dhcp_interface_key: "eth0"

# DHCP network options
bootstrap_dhcp_gateway: "192.168.1.1"
bootstrap_dhcp_netmask: "255.255.255.0"
bootstrap_dhcp_dns_servers:
  - "8.8.8.8"
  - "8.8.4.4"

# DHCP domain (optional, leave empty to disable)
bootstrap_dhcp_domain: ""

# PXE Boot Configuration
# ------------------------------------------------------------------------------
# Boot prompt message displayed to clients
bootstrap_pxe_boot_prompt: "Press <Tab> or <F1> for boot options, <Enter> to boot"

# Timeout before auto-boot (in deciseconds, 300 = 30 seconds)
bootstrap_pxe_timeout: 300

# DNS Configuration (dnsmasq backend only)
# ------------------------------------------------------------------------------
# Set to true to enable DNS functionality in dnsmasq
# If false, dnsmasq only provides DHCP + TFTP
bootstrap_enable_dns: false

# DNS upstream servers (if DNS is enabled, dnsmasq backend only)
# These are used for forwarding DNS queries
bootstrap_dns_upstream_servers: []

# Netboot Menu Entries
# ------------------------------------------------------------------------------
# List of netboot images to display in the PXE boot menu.
#
# IMPORTANT: This role does NOT fetch netboot images. Images must be pre-staged
# to {{ bootstrap_tftp_root }}/{{ dest_subdir }}/ by the artifacts role.
#
# Each entry requires:
#   - name: Display name in boot menu (e.g., "Fedora 43 Server")
#   - dest_subdir: Path under TFTP root where vmlinuz/initrd.img exist
#   - boot_options: (optional) Kernel command-line options
#
# Example:
# bootstrap_netboot_images:
#   - name: "Fedora 43 Server"
#     dest_subdir: "fedora/43"
#     boot_options: "inst.repo=http://192.168.1.10/iso/fedora/43 inst.ks=http://192.168.1.10/kickstart/builder.ks"
#
bootstrap_netboot_images: []

# Dnsmasq Service Configuration (dnsmasq backend only)
# ------------------------------------------------------------------------------
bootstrap_dnsmasq_conf_path: /etc/dnsmasq.conf

# Set to true to enable and start dnsmasq service (dnsmasq backend only)
bootstrap_dnsmasq_service_enabled: false

# Set to true to enable DHCP in dnsmasq (dnsmasq backend only)
# WARNING: Leave false if another DHCP server is on the network
# When false, dnsmasq only provides TFTP (and DNS if enabled)
bootstrap_dnsmasq_dhcp_enabled: false

# ==============================================================================
# END DNSMASQ-ONLY CONFIGURATION
# ==============================================================================

# SELinux Configuration
# ------------------------------------------------------------------------------
bootstrap_selinux_tftp_context: "tftpdir_rw_t"

# UEFI PXE Boot Configuration
# ------------------------------------------------------------------------------
# Enable UEFI PXE boot support (alongside legacy BIOS)
bootstrap_uefi_enabled: true

# UEFI bootloader to use for PXE:
#   - "ipxe": Use iPXE (recommended, best network stack)
#   - "grub": Use GRUB built with network modules
#   - "grub-local": Use system GRUB (may lack network modules - not recommended)
bootstrap_uefi_bootloader: "ipxe"

# GRUB2 timeout before auto-boot (in seconds)
bootstrap_grub_timeout: 30

# iPXE EFI binary source (from ipxe-bootimgs-x86 package)
# Options: ipxe-x86_64.efi (full), snponly-x86_64.efi (SNP driver only - most VM compatible)
bootstrap_ipxe_efi_source: "/usr/share/ipxe/ipxe-x86_64.efi"

# iPXE menu timeout in milliseconds (0 = no timeout, wait forever)
bootstrap_ipxe_menu_timeout: 30000

# iPXE boot script URL - how iPXE finds the boot script
# Set via DHCP filename option, or embed in iPXE binary
bootstrap_ipxe_script_name: "boot.ipxe"

# Source path for GRUB2 EFI bootloader (grub-local mode only)
bootstrap_grub_efi_source: "/boot/efi/EFI/fedora/grubx64.efi"

# GRUB modules directory (for building network-enabled GRUB)
bootstrap_grub_modules_dir: "/usr/lib/grub/x86_64-efi"

# Logging Configuration (dnsmasq backend only)
# ------------------------------------------------------------------------------
# Enable query logging for debugging
bootstrap_dnsmasq_log_queries: false

# Enable DHCP transaction logging
bootstrap_dnsmasq_log_dhcp: true

# Dnsmasq process ownership
bootstrap_dnsmasq_user: dnsmasq
bootstrap_dnsmasq_group: dnsmasq
